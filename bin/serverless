#!/usr/bin/env node

'use strict';

let argv = require('minimist')(process.argv.slice(2)),
    proxy = process.env.proxy || process.env.HTTP_PROXY || process.env.http_proxy || process.env.HTTPS_PROXY || process.env.https_proxy;

if(proxy) {
    let AWS = require('aws-sdk'),
        url = require('url'),
        HttpsProxyAgent = require('https-proxy-agent'),
        proxyOptions;
    proxyOptions = url.parse(proxy);
    proxyOptions.secureEndpoint = true;
    AWS.config.httpOptions.agent = new HttpsProxyAgent(proxyOptions);
}

if (argv.debug) process.env.DEBUG = '*';

let S           = require('../lib/Serverless'),
    SUtils      = require('../lib/utils/index'),
    serverless  = new S({
      interactive: typeof process.env.CI !== 'undefined' ? false : true,
      projectPath: SUtils.getProjectPath(process.cwd())
    });

serverless.command(argv);
